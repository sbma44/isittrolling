function foldl(a,b,c){for(var d=0;d<c.length;++d)b=a(b,c[d]);return b}function ParseState(a,b){return this.input=a,this.index=b||0,this.length=a.length-this.index,this.cache={},this}function ps(a){return new ParseState(a)}function make_result(a,b,c){return{remaining:a,matched:b,ast:c}}function token(a){var b=parser_id++;return function(c){var d=c,e=d.getCached(b);if(e)return e;var f=c.length>=a.length&&c.substring(0,a.length)==a;return f?e={remaining:c.from(a.length),matched:a,ast:a}:e=!1,d.putCached(b,e),e}}function ch(a){var b=parser_id++;return function(d){var e=d,f=e.getCached(b);if(f)return f;var g=d.length>=1&&d.at(0)==a;return g?f={remaining:d.from(1),matched:a,ast:a}:f=!1,e.putCached(b,f),f}}function range(a,b){var c=parser_id++;return function(d){var e=d,f=e.getCached(c);if(f)return f;if(d.length<1)f=!1;else{var g=d.at(0);g>=a&&g<=b?f={remaining:d.from(1),matched:g,ast:g}:f=!1}return e.putCached(c,f),f}}function toParser(a){return typeof a=="string"?token(a):a}function whitespace(a){var a=toParser(a),b=parser_id++;return function(c){var d=c,e=d.getCached(b);return e?e:(e=a(c.trimLeft()),d.putCached(b,e),e)}}function action(a,b){var a=toParser(a),c=parser_id++;return function(d){var e=d,g=e.getCached(c);if(g)return g;var h=a(d);return h?(h.ast=b(h.ast),g=h):g=!1,e.putCached(c,g),g}}function join_action(a,b){return action(a,function(a){return a.join(b)})}function left_factor(a){return foldl(function(a,b){return[a,b]},a[0],a[1])}function left_factor_action(a){return action(a,left_factor)}function negate(a){var a=toParser(a),b=parser_id++;return function(c){var d=c,e=d.getCached(b);if(e)return e;if(c.length>=1){var f=a(c);f?e=!1:e=make_result(c.from(1),c.at(0),c.at(0))}else e=!1;return d.putCached(b,e),e}}function end_p(a){return a.length==0?make_result(a,undefined,undefined):!1}function nothing_p(a){return!1}function sequence(){var a=[];for(var b=0;b<arguments.length;++b)a.push(toParser(arguments[b]));var c=parser_id++;return function(b){var d=b,e=d.getCached(c);if(e)return e;var f=[],g="",h;for(h=0;h<a.length;++h){var i=a[h],j=i(b);if(j)b=j.remaining,j.ast!=undefined&&(f.push(j.ast),g=g+j.matched);else break}return h==a.length?e=make_result(b,g,f):e=!1,d.putCached(c,e),e}}function wsequence(){var a=[];for(var b=0;b<arguments.length;++b)a.push(whitespace(toParser(arguments[b])));return sequence.apply(null,a)}function choice(){var a=[];for(var b=0;b<arguments.length;++b)a.push(toParser(arguments[b]));var c=parser_id++;return function(b){var d=b,e=d.getCached(c);if(e)return e;var f;for(f=0;f<a.length;++f){var g=a[f],h=g(b);if(h)break}return f==a.length?e=!1:e=h,d.putCached(c,e),e}}function butnot(a,b){var a=toParser(a),b=toParser(b),c=parser_id++;return function(d){var e=d,f=e.getCached(c);if(f)return f;var g=b(d);if(!g)f=a(d);else{var h=a(d);h?h.matched.length>g.matched.length?f=h:f=!1:f=!1}return e.putCached(c,f),f}}function difference(a,b){var a=toParser(a),b=toParser(b),c=parser_id++;return function(d){var e=d,f=e.getCached(c);if(f)return f;var g=b(d);if(!g)f=a(d);else{var h=a(d);h.matched.length>=g.matched.length?f=g:f=h}return e.putCached(c,f),f}}function xor(a,b){var a=toParser(a),b=toParser(b),c=parser_id++;return function(d){var e=d,f=e.getCached(c);if(f)return f;var g=a(d),h=b(d);return g&&h?f=!1:f=g||h,e.putCached(c,f),f}}function repeat0(a){var a=toParser(a),b=parser_id++;return function(c){var d=c,e=d.getCached(b);if(e)return e;var f=[],g="",h;while(h=a(c)){f.push(h.ast),g=g+h.matched;if(h.remaining.index==c.index)break;c=h.remaining}return e=make_result(c,g,f),d.putCached(b,e),e}}function repeat1(a){var a=toParser(a),b=parser_id++;return function(c){var d=c,e=d.getCached(b);if(e)return e;var f=[],g="",h=a(c);if(!h)e=!1;else{while(h){f.push(h.ast),g=g+h.matched;if(h.remaining.index==c.index)break;c=h.remaining,h=a(c)}e=make_result(c,g,f)}return d.putCached(b,e),e}}function optional(a){var a=toParser(a),b=parser_id++;return function(c){var d=c,e=d.getCached(b);if(e)return e;var f=a(c);return e=f||make_result(c,"",!1),d.putCached(b,e),e}}function expect(a){return action(a,function(a){return undefined})}function chain(a,b,c){var a=toParser(a);return action(sequence(a,repeat0(action(sequence(b,a),c))),function(a){return[a[0]].concat(a[1])})}function chainl(a,b){var a=toParser(a);return action(sequence(a,repeat0(sequence(b,a))),function(a){return foldl(function(a,b){return b[0](a,b[1])},a[0],a[1])})}function list(a,b){return chain(a,b,function(a){return a[1]})}function wlist(){var a=[];for(var b=0;b<arguments.length;++b)a.push(whitespace(arguments[b]));return list.apply(null,a)}function epsilon_p(a){return make_result(a,"",undefined)}function semantic(a){var b=parser_id++;return function(c){var d=c,e=d.getCached(b);return e?e:(e=a()?make_result(c,"",undefined):!1,d.putCached(b,e),e)}}function and(a){var a=toParser(a),b=parser_id++;return function(c){var d=c,e=d.getCached(b);if(e)return e;var f=a(c);return e=f?make_result(c,"",undefined):!1,d.putCached(b,e),e}}function not(a){var a=toParser(a),b=parser_id++;return function(c){var d=c,e=d.getCached(b);return e?e:(e=a(c)?!1:make_result(c,"",undefined),d.putCached(b,e),e)}}function pxxl(a,b,c){Pxxl.LoadFont(a,function(a){var d=a.getPixels(b);c(d,a)})}var memoize=!0;ParseState.prototype.from=function(a){var b=new ParseState(this.input,this.index+a);return b.cache=this.cache,b.length=this.length-a,b},ParseState.prototype.substring=function(a,b){return this.input.substring(a+this.index,(b||this.length)+this.index)},ParseState.prototype.trimLeft=function(){var a=this.substring(0),b=a.match(/^\s+/);return b?this.from(b[0].length):this},ParseState.prototype.at=function(a){return this.input.charAt(this.index+a)},ParseState.prototype.toString=function(){return'PS"'+this.substring(0)+'"'},ParseState.prototype.getCached=function(a){if(!memoize)return!1;var b=this.cache[a];return b?b[this.index]:!1},ParseState.prototype.putCached=function(a,b){if(!memoize)return!1;var c=this.cache[a];c?c[this.index]=b:(c=this.cache[a]={},c[this.index]=b)};var parser_id=0,Pxxl={};Pxxl.Font=function(a,b,c,d){this.version=a,this.comments=b,this.properties=c,this.glyphs=d},Pxxl.Font.prototype={size:function(){return this.SIZE[0]},getGlyph:function(a){var b=a.charCodeAt(0);return this.glyphs[b]},defaultWidth:function(){return this.FONTBOUNDINGBOX[0]},defaultHeight:function(){return this.FONTBOUNDINGBOX[1]},bit:function(a,b,c){var d=~~(c/8);if(d<0||d>a.length-1)return!1;var e=a.charCodeAt(d),f=this.glyphs[e];return f?f.bit(b,c%8):!1},getPixels:function(a){var b=this.ctx,c=this.FONTBOUNDINGBOX[0],d=[];for(var e=0;e<a.length;e++){var f=a.charCodeAt(e),g=this.glyphs[f],h=g.bitmap,i=e*c,j=this.defaultHeight()-g.height();for(var k=0;k<h.length;k++){var l=h[k];for(var m=0;m<l.length;m++){var n=l[m],o=m*8,p=256;while(p>>>=1){if(n&p){var q=i+o,r=j+k;d.push({x:q,y:r,row:k,column:o})}o++}}}}return d}},Pxxl.Glyph=function(a,b){this.name=a,this.bitmap=b},Pxxl.Glyph.prototype={set:function(a,b,c){var d=1<<this.width()-a-1,e=~~(d/256);d%=(e+1)*256,c?this.bitmap[b][e]|=d:this.bitmap[b][e]&=~d},get:function(a,b){var c=1<<this.width()-a-1,d=~~(c/256);c%=(d+1)*256;var e=this.bitmap[b][d]&c;return!!e},width:function(){return this.BBX[0]},height:function(){return this.BBX[1]},toString:function(){var a="";for(var b=0;b<this.bitmap.length;b++){for(var c=0;c<this.width();c++)a+=this.get(c,b)?"*":" ";a+="/n"}return a}},function(){function by(a){var b=a[1],c=a[0].concat(a[2]),d=a[3],e=bB(a[4]),f=new Pxxl.Font(b,c,d,e);return bA(f,d)}function bz(a){var b=a[0],c=a[1],d=a[2],e=new Pxxl.Glyph(b,d);return e=bA(e,c),{name:e.ENCODING,value:e}}function bA(a,b){for(var c=0;c<b.length;c++){var d=b[c];a[d.name]=d.value}return a}function bB(a){var b={};for(var c=0;c<a.length;c++){var d=a[c];b[d.name]=d.value}return b}function bC(a){var b=a[1],c=a[0];if(c=="ENCODING"||c=="CHARS")b=b[0];return{name:c,value:b}}function bD(a){return{name:a[0],value:a[2]}}function bE(a){return join_action(a,"")}function bF(a,b){return action(b,function(b){return b[a]})}function bG(a,b){var c=Pxxl.trace,d=Pxxl.traceall;return c?function(c){var e=a(c);if(!e.ast){var f=c.input.substring(0,c.index),g=f.split("\n");console.error(b,"failed at line",g.length,c)}return e.ast&&d&&console.log(b,"matches",e.matched,"\nAST:",e.ast),e}:a}function bH(a){var b=a.split("\n");for(var c=b.length-1;c>=0;c--){var d=bI(b[c]);d==""?b.splice(c,1):b[c]=d}return b.join("\n")}function bI(a){return a.replace(/^\s+/,"")}function bJ(a,b,c){Pxxl.trace=b,Pxxl.traceall=c,a=bH(a);var d=ps(a),e=+(new Date),f=bx(d),g=+(new Date)-e;if(f.ast)return f.ast;throw new Error("Unable to parse font!")}var a=ch("!"),b=ch("@"),c=ch("#"),d=ch("$"),e=ch("%"),f=ch("^"),g=ch("&"),h=ch("*"),i=ch("("),j=ch(")"),k=ch("-"),l=ch("_"),m=ch("+"),n=ch("="),o=ch("{"),p=ch("}"),q=ch("["),r=ch("]"),s=ch(":"),t=ch(";"),u=ch("'"),v=ch('"'),w=ch("|"),x=ch("\\"),y=ch("~"),z=ch("`"),A=ch(","),B=ch("."),C=ch("<"),D=ch(">"),E=ch("?"),F=ch("/"),G=choice(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F),H=range("0","9"),I=range("a","z"),J=range("A","Z"),K=ch("\n"),L=ch(" "),M=ch("\t"),N=choice(I,J),O=choice(N,H),P=choice(O,G),Q=choice(P,L),R=bE(repeat1(L)),S=bE(repeat1(Q)),T=sequence(repeat0(L),K),U=bF(1,sequence(v,bE(repeat1(butnot(Q,v))),v)),V=choice(range("a","f"),range("A","F"),H),W=action(bE(sequence(V,V)),function(a){return parseInt(a,16)}),X=repeat1(W),Y=bE(repeat1(H)),Z=bE(sequence(k,Y)),$=action(choice(Y,Z),parseInt),_=bE(repeat1(choice(N,l))),ba=action(sequence(_,repeat1(bF(1,sequence(R,$)))),bC),bb=action(sequence(_,R,U),bD),bc=action(sequence(_,R,bE(repeat1(P))),bD),bd=token("ENDPROPERTIES"),be=bG(choice(ba,bb,bc,bd),"prop"),bf=bF(0,sequence(be,T)),bg=bF(0,sequence(X,T)),bh=token("BITMAP"),bi=sequence(bh,T),bj=bG(bF(1,sequence(bi,repeat0(bg))),"bitmap"),bk=token("STARTCHAR"),bl=token("ENDCHAR"),bm=bG(bF(2,sequence(bk,L,S,T)),"glyphstart"),bn=sequence(bl,T),bo=bG(action(sequence(bm,repeat0(bf),bj,bn),bz),"glyph"),bp=token("STARTFONT"),bq=token("ENDFONT"),br=bE(sequence(Y,B,Y)),bs=bG(bF(2,sequence(bp,R,br,T)),"fontstart"),bt=bG(sequence(bq,optional(T)),"fontend"),bu=token("COMMENT"),bv=bF(2,sequence(bu,optional(L),optional(S))),bw=bG(bF(0,sequence(bv,T)),"comment"),bx=action(sequence(repeat0(bw),bs,repeat0(bw),repeat0(butnot(bf,bm)),repeat0(bo),bt),by);Pxxl.Font.ParseBDF=bJ}(),Pxxl.Glyph.ParseJSON=function(a){var b=new Pxxl.Glyph(a.name,a.bitmap);for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},Pxxl.Font.ParseJSON=function(a){var b=new Pxxl.Font(a.version,a.comments,a.properties,{});for(var c in a)a.hasOwnProperty(c)&&c!="glyphs"&&(b[c]=a[c]);b.glyphs={};for(var d in a.glyphs)a.glyphs.hasOwnProperty(d)&&(b.glyphs[d]=Pxxl.Glyph.ParseJSON(a.glyphs[d]));return b},function(){function a(a,b,d){var e=c();if(!e)return;var f=d?"POST":"GET";e.open(f,a,!0),d&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(e.readyState!=4)return;if(e.status!=200&&e.status!=304)return;b(e)};if(e.readyState==4)return;e.send(d)}function c(){var a=!1;for(var c=0;c<b.length;c++){try{a=b[c]()}catch(d){continue}break}return a}function d(b,c){a(b,function(a){c(Pxxl.Font.ParseBDF(a.responseText))})}function e(a){var b={};return function(c,d){var e=b[c];return typeof e!="undefined"?d(e):a(c,function(a){return b[c]=a,d(a)})}}var b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];Pxxl.LoadFont=e(d)}();